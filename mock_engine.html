<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDTRIX | Mock Engine</title>
    <script src="medtrix_core.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #f0f4f8; --card: rgba(255,255,255,0.95); --text: #1a202c; --accent: #007bff; --success: #10b981; --danger: #ef4444; }
        [data-theme="dark"] { --bg: #0f1115; --card: rgba(20,22,27,0.9); --text: #f7fafc; --accent: #00e5ff; }
        body { background: var(--bg); color: var(--text); font-family: 'Poppins', sans-serif; padding: 20px; text-align: center; }
        
        .container { max-width: 800px; margin: 0 auto; background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .btn { padding: 15px 30px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; background: var(--accent); color: white; font-size: 1.2rem; width: 100%; margin-top: 20px; }
        
        #quiz { display: none; text-align: left; }
        .opt { width: 100%; padding: 15px; margin-bottom: 10px; border: 2px solid rgba(128,128,128,0.2); border-radius: 10px; background: transparent; color: var(--text); cursor: pointer; }
        .opt.sel { border-color: var(--accent); background: rgba(0,123,255,0.1); }
    </style>
</head>
<body>
    <div class="container" id="start">
        <a href="index.html" style="text-decoration:none; float:left; font-size:1.5rem;">ðŸ”™</a>
        <h1 style="font-family:'Orbitron'; color:var(--accent)">GRAND MOCK</h1>
        <p>200 Questions â€¢ High Yield Algorithm</p>
        <button class="btn" onclick="init()">START EXAM</button>
        <p id="log" style="margin-top:10px; font-size:0.8rem; opacity:0.7;"></p>
    </div>

    <div class="container" id="quiz">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <span id="prog">Q 1/200</span>
            <span id="timer" style="color:var(--danger); font-weight:bold;">03:30:00</span>
        </div>
        <div id="q-text" style="font-weight:600; font-size:1.1rem; margin-bottom:20px;"></div>
        <div id="opts"></div>
        <div style="display:flex; justify-content:space-between; margin-top:20px;">
            <button class="btn" style="width:45%; background:gray" onclick="nav(-1)">Prev</button>
            <button class="btn" style="width:45%" onclick="nav(1)">Next</button>
        </div>
    </div>

<script>
    let questions = [], idx = 0, answers = {};
    
    async function init() {
        document.getElementById('log').innerText = "Analyzing database...";
        const manifest = await MEDTRIX.data.getManifest();
        
        // Weighted Selection Logic
        const weights = { "Pathology": 0.13, "Medicine": 0.1, "Surgery": 0.1, "OBG": 0.1, "PSM": 0.09, "Pharmacology": 0.08 };
        let finalQs = [];

        for(let f of manifest) {
            // Randomly sample from files based on weights
            if(Math.random() > 0.8) { // Only sample 20% of files to stay fast
                try {
                    const data = await MEDTRIX.data.getQuiz(f.file);
                    if(data && data.questions) {
                        const sub = MEDTRIX.data.detectCategory(f.file);
                        // Simple logic: Take 2 questions from each sampled file
                        finalQs.push(...data.questions.slice(0, 2));
                    }
                } catch(e) {}
            }
            document.getElementById('log').innerText = `Loaded ${finalQs.length} questions...`;
            if(finalQs.length >= 200) break;
        }

        questions = finalQs.slice(0, 200);
        if(questions.length === 0) return alert("No questions found. Run python script.");
        
        document.getElementById('start').style.display = 'none';
        document.getElementById('quiz').style.display = 'block';
        render();
    }

    function render() {
        const q = questions[idx];
        document.getElementById('prog').innerText = `Q ${idx+1}/200`;
        document.getElementById('q-text').innerHTML = q.text;
        document.getElementById('opts').innerHTML = q.options.map((o,i) => 
            `<div class="opt ${answers[idx]===i?'sel':''}" onclick="pick(${i})">${o.text}</div>`
        ).join('');
    }

    function pick(i) { answers[idx] = i; render(); }
    function nav(d) {
        if(idx+d >= 0 && idx+d < questions.length) { idx += d; render(); }
        else if(idx+d === questions.length) finish();
    }

    function finish() {
        alert("Exam Done! Check Analytics for score.");
        // Logic to calculate score and save to MEDTRIX.db would go here
        location.href = "analytics.html";
    }
</script>
</body>
</html>