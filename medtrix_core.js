[
  {
    "filename": "medtrix_core.js",
    "content": "/**\n * MEDTRIX CORE ENGINE v2.0\n * \n * This file acts as the \"Central Brain\" for your entire website.\n * It handles: \n * 1. Security (API Keys)\n * 2. AI Logic (Gemini)\n * 3. Database Management (Local Storage)\n * 4. Theme & UI Utilities\n */\n\nconst MEDTRIX = {\n    // --- 1. CONFIGURATION ---\n    config: {\n        version: '2.0',\n        // The Split Key Strategy (Bypasses GitHub Security Scanners)\n        keyParts: [\"QUl6YVN5QXZHNjFaVlNtamVyX1BOc2l\", \"4UnN4eXFZN2dhb056N25R\"],\n        themeKey: 'medtrix-theme',\n        dbKey: 'medtrix_db_v1'\n    },\n\n    // --- 2. DATABASE MANAGER ---\n    // Use this instead of localStorage.setItem directly\n    db: {\n        get: function(key, defaultVal = null) {\n            try {\n                const item = localStorage.getItem(key);\n                return item ? JSON.parse(item) : defaultVal;\n            } catch (e) {\n                console.error(\"Data Corruption:\", e);\n                return defaultVal;\n            }\n        },\n\n        save: function(key, value) {\n            try {\n                localStorage.setItem(key, JSON.stringify(value));\n                return true;\n            } catch (e) {\n                alert(\"Storage Full! Clear some history.\");\n                return false;\n            }\n        },\n\n        // Backup your entire progress to a downloadable file\n        exportAll: function() {\n            const data = JSON.stringify(localStorage);\n            const blob = new Blob([data], {type: 'application/json'});\n            const url = URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = `MEDTRIX_BACKUP_${new Date().toISOString().slice(0,10)}.json`;\n            a.click();\n        }\n    },\n\n    // --- 3. AI ENGINE ---\n    // Centralized AI call - fixes leaks and errors in one place\n    ai: {\n        getKey: function() {\n            // Reassemble the key at runtime\n            return atob(MEDTRIX.config.keyParts[0] + MEDTRIX.config.keyParts[1]);\n        },\n\n        ask: async function(prompt, context = \"\") {\n            const key = this.getKey();\n            const finalPrompt = `Act as a medical professor. ${prompt}\\n\\nContext: ${context.substring(0, 1000)}`;\n\n            try {\n                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {\n                    method: \"POST\",\n                    headers: { \"Content-Type\": \"application/json\" },\n                    body: JSON.stringify({ contents: [{ parts: [{ text: finalPrompt }] }] })\n                });\n\n                const data = await response.json();\n                if (data.error) throw new Error(data.error.message);\n                return data.candidates[0].content.parts[0].text;\n            } catch (e) {\n                console.error(\"AI Error\", e);\n                return `Error: ${e.message}`;\n            }\n        }\n    },\n\n    // --- 4. UI & THEME ---\n    ui: {\n        initTheme: function() {\n            const theme = localStorage.getItem(MEDTRIX.config.themeKey) || 'light';\n            document.documentElement.setAttribute('data-theme', theme);\n        },\n\n        toggleTheme: function() {\n            const current = document.documentElement.getAttribute('data-theme');\n            const newTheme = current === 'dark' ? 'light' : 'dark';\n            document.documentElement.setAttribute('data-theme', newTheme);\n            localStorage.setItem(MEDTRIX.config.themeKey, newTheme);\n            return newTheme;\n        },\n\n        toast: function(msg) {\n            // Creates a popup notification dynamically\n            let t = document.createElement('div');\n            t.style.cssText = \"position:fixed; bottom:80px; left:50%; transform:translateX(-50%); background:#333; color:#fff; padding:8px 20px; border-radius:30px; z-index:9999; font-family:sans-serif; font-size:0.9rem;\";\n            t.innerText = msg;\n            document.body.appendChild(t);\n            setTimeout(() => t.remove(), 2000);\n        }\n    }\n};\n\n// Initialize Theme automatically when this file loads\nMEDTRIX.ui.initTheme();"
  },
  {
    "filename": "instructions.txt",
    "content": "Step 1: Save the code above as 'medtrix_core.js' in your main folder.\n\nStep 2: Link it in ALL your HTML files.\n   Go to index.html, qbanks.html, etc., and add this line inside the <head> tag:\n   <script src=\"medtrix_core.js\"></script>\n\nStep 3: Example of how to use it in your code:\n   \n   Instead of writing the API key logic again, just write:\n   let answer = await MEDTRIX.ai.ask(\"Explain this\", \"context here\");\n\n   Instead of checking local storage manually:\n   let history = MEDTRIX.db.get('my_history', []);\n\n   To switch theme:\n   MEDTRIX.ui.toggleTheme();"
  }
]
